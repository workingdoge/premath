amends "package://github.com/jdx/hk/releases/download/v1.36.0/hk@1.36.0#/Config.pkl"

default_branch = "main"

exclude = List(
  ".git",
  ".jj",
  "target",
  "__pycache__",
  ".venv",
  "venv",
)

local fast_steps = new Mapping<String, Step> {
  ["check-merge-conflict"] {
    glob = List("**/*")
    check = "hk util check-merge-conflict --assume-in-merge {{files}}"
  }

  ["detect-private-key"] {
    glob = List("**/*")
    check = "hk util detect-private-key {{files}}"
  }

  ["trailing-whitespace"] {
    glob = List("**/*")
    check = "hk util trailing-whitespace --diff {{files}}"
    fix = "hk util trailing-whitespace --fix {{files}}"
  }

  ["end-of-file-fixer"] {
    glob = List("**/*")
    check = "hk util end-of-file-fixer --diff {{files}}"
    fix = "hk util end-of-file-fixer --fix {{files}}"
  }

  ["rustfmt"] {
    glob = List("**/*.rs")
    check_first = true
    check = "cargo fmt --all -- --check"
    fix = "cargo fmt --all"
  }
}

local baseline_steps = new Mapping<String, Step> {
  ["baseline"] {
    check = "mise run baseline"
    exclusive = true
  }
}

hooks {
  ["pre-commit"] {
    fix = true
    stash = "git"
    steps = fast_steps
  }

  ["pre-push"] {
    steps = baseline_steps
  }

  ["check"] {
    steps = baseline_steps
  }

  ["fix"] {
    fix = true
    stash = "git"
    steps = fast_steps
  }
}
