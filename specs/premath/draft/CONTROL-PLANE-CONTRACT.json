{
  "schema": 1,
  "contractKind": "premath.control_plane.contract.v1",
  "contractId": "control-plane.default.v1",
  "schemaLifecycle": {
    "activeEpoch": "2026-02",
    "governance": {
      "mode": "rollover",
      "decisionRef": "decision-0105",
      "owner": "premath-core",
      "rolloverCadenceMonths": 6
    },
    "kindFamilies": {
      "controlPlaneContractKind": {
        "canonicalKind": "premath.control_plane.contract.v1",
        "compatibilityAliases": [
          {
            "aliasKind": "premath.control_plane.contract.v0",
            "supportUntilEpoch": "2026-06",
            "replacementKind": "premath.control_plane.contract.v1"
          }
        ]
      },
      "requiredWitnessKind": {
        "canonicalKind": "ci.required.v1",
        "compatibilityAliases": [
          {
            "aliasKind": "ci.required.v0",
            "supportUntilEpoch": "2026-06",
            "replacementKind": "ci.required.v1"
          }
        ]
      },
      "requiredDecisionKind": {
        "canonicalKind": "ci.required.decision.v1",
        "compatibilityAliases": [
          {
            "aliasKind": "ci.required.decision.v0",
            "supportUntilEpoch": "2026-06",
            "replacementKind": "ci.required.decision.v1"
          }
        ]
      },
      "instructionWitnessKind": {
        "canonicalKind": "ci.instruction.v1",
        "compatibilityAliases": [
          {
            "aliasKind": "ci.instruction.v0",
            "supportUntilEpoch": "2026-06",
            "replacementKind": "ci.instruction.v1"
          }
        ]
      },
      "instructionPolicyKind": {
        "canonicalKind": "ci.instruction.policy.v1",
        "compatibilityAliases": [
          {
            "aliasKind": "ci.instruction.policy.v0",
            "supportUntilEpoch": "2026-06",
            "replacementKind": "ci.instruction.policy.v1"
          }
        ]
      },
      "requiredProjectionPolicy": {
        "canonicalKind": "ci-topos-v0",
        "compatibilityAliases": [
          {
            "aliasKind": "ci-topos-v0-preview",
            "supportUntilEpoch": "2026-06",
            "replacementKind": "ci-topos-v0"
          }
        ]
      },
      "requiredDeltaKind": {
        "canonicalKind": "ci.required.delta.v1",
        "compatibilityAliases": [
          {
            "aliasKind": "ci.delta.v1",
            "supportUntilEpoch": "2026-06",
            "replacementKind": "ci.required.delta.v1"
          }
        ]
      }
    }
  },
  "controlPlaneBundleProfile": {
    "profileId": "cp.bundle.v0",
    "contextFamily": {
      "id": "C_cp",
      "contextKinds": [
        "repo_head",
        "workspace_delta",
        "instruction_envelope",
        "policy_snapshot",
        "witness_projection"
      ],
      "morphismKinds": [
        "ctx.identity",
        "ctx.rebase",
        "ctx.patch",
        "ctx.policy_rollover"
      ]
    },
    "artifactFamily": {
      "id": "E_cp",
      "artifactRefs": {
        "controlPlaneContract": "specs/premath/draft/CONTROL-PLANE-CONTRACT.json",
        "coherenceContract": "specs/premath/draft/COHERENCE-CONTRACT.json",
        "capabilityRegistry": "specs/premath/draft/CAPABILITY-REGISTRY.json",
        "doctrineSiteInput": "specs/premath/draft/DOCTRINE-SITE-INPUT.json",
        "doctrineOpRegistry": "specs/premath/draft/DOCTRINE-OP-REGISTRY.json"
      }
    },
    "reindexingCoherence": {
      "requiredObligations": [
        "identity_preserved",
        "composition_preserved",
        "policy_digest_stable",
        "route_bindings_total"
      ],
      "commutationWitness": "span_square_commutation"
    },
    "coverGlue": {
      "workerCoverKind": "worktree_partition_cover",
      "mergeCompatibilityWitness": "span_square_commutation",
      "requiredMergeArtifacts": [
        "ci.required.v1",
        "ci.instruction.v1",
        "coherence_witness"
      ]
    },
    "authoritySplit": {
      "semanticAuthority": [
        "PREMATH-KERNEL",
        "GATE",
        "BIDIR-DESCENT"
      ],
      "controlPlaneRole": "projection_and_parity_only",
      "forbiddenControlPlaneRoles": [
        "semantic_obligation_discharge",
        "admissibility_override"
      ]
    }
  },
  "controlPlaneKcirMappings": {
    "profileId": "cp.kcir.mapping.v0",
    "mappingTable": {
      "instructionEnvelope": {
        "sourceKind": "ci.instruction.envelope.v1",
        "targetDomain": "kcir.node",
        "targetKind": "ci.instruction.v1",
        "identityFields": [
          "instructionDigest",
          "normalizerId",
          "policyDigest"
        ]
      },
      "proposalPayload": {
        "sourceKind": "ci.proposal.payload.v1",
        "targetDomain": "kcir.node",
        "targetKind": "ci.proposal.check.v1",
        "identityFields": [
          "proposalDigest",
          "proposalKcirRef",
          "policyDigest"
        ]
      },
      "coherenceObligations": {
        "sourceKind": "coherence.obligation.set.v1",
        "targetDomain": "kcir.node",
        "targetKind": "coherence.obligation.witness.v1",
        "identityFields": [
          "obligationDigest",
          "normalizerId",
          "policyDigest"
        ]
      },
      "coherenceCheckPayload": {
        "sourceKind": "coherence.check.payload.v1",
        "targetDomain": "kcir.node",
        "targetKind": "coherence.check.witness.v1",
        "identityFields": [
          "projectionDigest",
          "normalizerId",
          "policyDigest"
        ]
      },
      "doctrineRouteBinding": {
        "sourceKind": "doctrine.route.binding.v1",
        "targetDomain": "kcir.node",
        "targetKind": "doctrine.route.witness.v1",
        "identityFields": [
          "operationId",
          "siteDigest",
          "policyDigest"
        ]
      },
      "requiredDecisionInput": {
        "sourceKind": "ci.required.decision.input.v1",
        "targetDomain": "kcir.node",
        "targetKind": "ci.required.decision.v1",
        "identityFields": [
          "requiredDigest",
          "decisionDigest",
          "policyDigest"
        ]
      }
    },
    "identityDigestLineage": {
      "digestAlgorithm": "sha256",
      "refProfilePath": "policies/ref/sha256_detached_v1.json",
      "normalizerField": "normalizerId",
      "policyDigestField": "policyDigest"
    },
    "compatibilityPolicy": {
      "legacyNonKcirEncodings": {
        "mode": "projection_only",
        "authorityMode": "forbidden",
        "supportUntilEpoch": "2026-06",
        "failureClass": "kcir_mapping_legacy_encoding_authority_violation"
      }
    }
  },
  "evidenceLanes": {
    "semanticDoctrine": "semantic_doctrine",
    "strictChecker": "strict_checker",
    "witnessCommutation": "witness_commutation",
    "runtimeTransport": "runtime_transport"
  },
  "laneArtifactKinds": {
    "semantic_doctrine": [
      "kernel_obligation",
      "gate_failure_class",
      "adjoint_site_obligation"
    ],
    "strict_checker": [
      "coherence_obligation",
      "cwf_strict_equality"
    ],
    "witness_commutation": [
      "span_ref",
      "square_witness"
    ],
    "runtime_transport": [
      "squeak_transport_witness",
      "squeak_site_witness"
    ]
  },
  "laneOwnership": {
    "checkerCoreOnlyObligations": [
      "cwf_substitution_identity",
      "cwf_substitution_composition",
      "cwf_comprehension_beta",
      "cwf_comprehension_eta"
    ],
    "requiredCrossLaneWitnessRoute": {
      "pullbackBaseChange": "span_square_commutation"
    }
  },
  "laneFailureClasses": [
    "lane_unknown",
    "lane_kind_unbound",
    "lane_ownership_violation",
    "lane_route_missing"
  ],
  "workerLaneAuthority": {
    "mutationPolicy": {
      "defaultMode": "instruction-linked",
      "allowedModes": [
        "instruction-linked",
        "human-override"
      ],
      "compatibilityOverrides": [
        {
          "mode": "human-override",
          "supportUntilEpoch": "2026-06",
          "requiresReason": true
        }
      ]
    },
    "mutationRoutes": {
      "issueClaim": "capabilities.change_morphisms.issue_claim",
      "issueLeaseRenew": "capabilities.change_morphisms.issue_lease_renew",
      "issueLeaseRelease": "capabilities.change_morphisms.issue_lease_release",
      "issueDiscover": "capabilities.change_morphisms.issue_discover"
    },
    "failureClasses": {
      "policyDrift": "worker_lane_policy_drift",
      "mutationModeDrift": "worker_lane_mutation_mode_drift",
      "routeUnbound": "worker_lane_route_unbound"
    }
  },
  "runtimeRouteBindings": {
    "requiredOperationRoutes": {
      "runGate": {
        "operationId": "op/ci.run_gate",
        "requiredMorphisms": [
          "dm.identity",
          "dm.profile.execution",
          "dm.transport.location",
          "dm.transport.world"
        ]
      },
      "runGateTerraform": {
        "operationId": "op/ci.run_gate_terraform",
        "requiredMorphisms": [
          "dm.identity",
          "dm.profile.execution",
          "dm.transport.location",
          "dm.transport.world"
        ]
      }
    },
    "failureClasses": {
      "missingRoute": "runtime_route_missing",
      "morphismDrift": "runtime_route_morphism_drift",
      "contractUnbound": "runtime_route_contract_unbound"
    }
  },
  "commandSurface": {
    "requiredDecision": {
      "canonicalEntrypoint": [
        "mise",
        "run",
        "ci-required-attested"
      ],
      "compatibilityAliases": [
        [
          "mise",
          "run",
          "ci-check"
        ]
      ]
    },
    "instructionEnvelopeCheck": {
      "canonicalEntrypoint": [
        "python3",
        "tools/ci/check_instruction_envelope.py"
      ],
      "compatibilityAliases": []
    },
    "instructionDecision": {
      "canonicalEntrypoint": [
        "python3",
        "tools/ci/run_instruction.py"
      ],
      "compatibilityAliases": [
        [
          "sh",
          "tools/ci/run_instruction.sh"
        ]
      ]
    },
    "failureClasses": {
      "unbound": "control_plane_command_surface_unbound"
    }
  },
  "harnessRetry": {
    "policyKind": "ci.harness.retry.policy.v1",
    "policyPath": "policies/control/harness-retry-policy-v1.json",
    "escalationActions": [
      "issue_discover",
      "mark_blocked",
      "stop"
    ],
    "activeIssueEnvKeys": [
      "PREMATH_ACTIVE_ISSUE_ID",
      "PREMATH_ISSUE_ID"
    ],
    "issuesPathEnvKey": "PREMATH_ISSUES_PATH",
    "sessionPathEnvKey": "PREMATH_HARNESS_SESSION_PATH",
    "sessionPathDefault": ".premath/harness_session.json",
    "sessionIssueField": "issueId"
  },
  "requiredGateProjection": {
    "projectionPolicy": "ci-topos-v0",
    "checkIds": {
      "baseline": "baseline",
      "build": "build",
      "test": "test",
      "testToy": "test-toy",
      "testKcirToy": "test-kcir-toy",
      "conformanceCheck": "conformance-check",
      "conformanceRun": "conformance-run",
      "doctrineCheck": "doctrine-check"
    },
    "checkOrder": [
      "baseline",
      "build",
      "test",
      "test-toy",
      "test-kcir-toy",
      "conformance-check",
      "conformance-run",
      "doctrine-check"
    ]
  },
  "requiredWitness": {
    "witnessKind": "ci.required.v1",
    "decisionKind": "ci.required.decision.v1"
  },
  "instructionWitness": {
    "witnessKind": "ci.instruction.v1",
    "policyKind": "ci.instruction.policy.v1",
    "policyDigestPrefix": "pol1_"
  },
  "evidenceStage1Parity": {
    "profileKind": "ev.stage1.core.v1",
    "authorityToTypedCoreRoute": "authority_to_typed_core_projection",
    "comparisonTuple": {
      "authorityDigestRef": "authorityPayloadDigest",
      "typedCoreDigestRef": "typedCoreProjectionDigest",
      "normalizerIdRef": "normalizerId",
      "policyDigestRef": "policyDigest"
    },
    "failureClasses": {
      "missing": "unification.evidence_stage1.parity.missing",
      "mismatch": "unification.evidence_stage1.parity.mismatch",
      "unbound": "unification.evidence_stage1.parity.unbound"
    }
  },
  "evidenceStage1Rollback": {
    "profileKind": "ev.stage1.rollback.v1",
    "witnessKind": "ev.stage1.rollback.witness.v1",
    "fromStage": "stage1",
    "toStage": "stage0",
    "triggerFailureClasses": [
      "unification.evidence_stage1.parity.missing",
      "unification.evidence_stage1.parity.mismatch",
      "unification.evidence_stage1.parity.unbound"
    ],
    "identityRefs": {
      "authorityDigestRef": "authorityPayloadDigest",
      "rollbackAuthorityDigestRef": "rollbackAuthorityPayloadDigest",
      "normalizerIdRef": "normalizerId",
      "policyDigestRef": "policyDigest"
    },
    "failureClasses": {
      "precondition": "unification.evidence_stage1.rollback.precondition",
      "identityDrift": "unification.evidence_stage1.rollback.identity_drift",
      "unbound": "unification.evidence_stage1.rollback.unbound"
    }
  },
  "evidenceStage2Authority": {
    "profileKind": "ev.stage2.authority.v1",
    "activeStage": "stage2",
    "typedAuthority": {
      "kindRef": "ev.stage1.core.v1",
      "digestRef": "typedCoreProjectionDigest",
      "normalizerIdRef": "normalizerId",
      "policyDigestRef": "policyDigest"
    },
    "compatibilityAlias": {
      "kindRef": "ev.legacy.payload.v1",
      "digestRef": "authorityPayloadDigest",
      "role": "projection_only",
      "supportUntilEpoch": "2026-06"
    },
    "bidirEvidenceRoute": {
      "routeKind": "direct_checker_discharge",
      "obligationFieldRef": "bidirCheckerObligations",
      "requiredObligations": [
        "stability",
        "locality",
        "descent_exists",
        "descent_contractible",
        "adjoint_triple",
        "ext_gap",
        "ext_ambiguous"
      ],
      "failureClasses": {
        "missing": "unification.evidence_stage2.kernel_compliance_missing",
        "drift": "unification.evidence_stage2.kernel_compliance_drift"
      },
      "fallback": {
        "mode": "profile_gated_sentinel",
        "profileKinds": []
      }
    },
    "failureClasses": {
      "authorityAliasViolation": "unification.evidence_stage2.authority_alias_violation",
      "aliasWindowViolation": "unification.evidence_stage2.alias_window_violation",
      "unbound": "unification.evidence_stage2.unbound"
    }
  },
  "evidenceFactorization": {
    "profileKind": "ev.factorization.v1",
    "routeKind": "eta_F_to_Ev",
    "factorizationRoutes": [
      "eta.control_plane_to_ev"
    ],
    "binding": {
      "normalizerIdRef": "normalizerId",
      "policyDigestRef": "policyDigest"
    },
    "crossLaneRoutes": {
      "pullbackBaseChange": "span_square_commutation"
    },
    "failureClasses": {
      "missing": "unification.evidence_factorization.missing",
      "ambiguous": "unification.evidence_factorization.ambiguous",
      "unbound": "unification.evidence_factorization.unbound"
    }
  }
}
